@inherits LayoutComponentBase
@attribute [Authorize]

<HeadContent>
    <RadzenTheme Theme="material" />
</HeadContent>

<RadzenLayout>
    <RadzenHeader Style="background-color:white;">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Normal" JustifyContent="JustifyContent.SpaceBetween" Gap="0">
            <AuthorizeView>
                <Authorized>
                    <RadzenStack Style="height 100%; background: var(--rz-primary-light) no-repeat url('/images/UserSVGRightSide.svg')">
                        <RadzenSidebarToggle Style="height 100%; color:white" class="sidebar-toggle" Click="@(() => sidebar1Expanded = !sidebar1Expanded)" />
                    </RadzenStack>
                    <RadzenProfileMenu Style="background: var(--rz-primary-light) no-repeat url('/images/UserSVGv2.svg')">
                        <Template>
                            <RadzenImage Path="images/notFoundUser.png" Style="width: 40px; height: 40px;" class="rz-border-radius-10" />
                        </Template>
                        <ChildContent>
                            <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" JustifyContent="JustifyContent.Center" Style="width: 100%; height: 100%;">
                                <RadzenButton Text="Профиль" Icon="account_circle" Click="@OnMyProfileClick" Variant="Variant.Text" ButtonStyle="ButtonStyle.Dark" Size="ButtonSize.ExtraSmall" Style="width: 100%; text-transform: none; border-radius: 0px;"></RadzenButton>
                                <RadzenButton Text="Настройки" Icon="settings" Click="@OnSettingsClick" Variant="Variant.Text" ButtonStyle="ButtonStyle.Dark" Size="ButtonSize.ExtraSmall" Style="width: 100%; text-transform: none; border-radius: 0px;"></RadzenButton>
                                <RadzenButton Text="Выход" Icon="logout" Click="@OnLogoutClick" Variant="Variant.Text" ButtonStyle="ButtonStyle.Dark" Size="ButtonSize.ExtraSmall" Style="width: 100%; text-transform: none; border-radius: 0px;"></RadzenButton>
                            </RadzenStack>
                        </ChildContent>
                    </RadzenProfileMenu>
                </Authorized>
                <NotAuthorized>
                    <RadzenLabel Text="GrapeIntegration" Style="color:black;" />
                    <RadzenProfileMenu Style="background: var(--rz-primary-light) no-repeat url('/images/UserSVGv2.svg')">
                        <Template>
                            <RadzenImage Path="images/notFoundUser.png" class="rz-border-radius-10" Style="width: 40px; height: 40px;" />
                        </Template>
                        <ChildContent>
                            <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" JustifyContent="JustifyContent.Center" Style="width: 100%; height: 100%;">
                                <RadzenButton Text="Войти" Icon="login" Click="@OnLogin" Variant="Variant.Text" ButtonStyle="ButtonStyle.Dark" Size="ButtonSize.ExtraSmall" Style="width: 100%; text-transform: none; border-radius: 0px;"></RadzenButton>
                                <RadzenButton Text="Регистрация" Icon="person_add" Click="@OnRegister" Variant="Variant.Text" ButtonStyle="ButtonStyle.Dark" Size="ButtonSize.ExtraSmall" Style="width: 100%; text-transform: none; border-radius: 0px;"></RadzenButton>
                            </RadzenStack>
                        </ChildContent>
                    </RadzenProfileMenu>
                </NotAuthorized>
            </AuthorizeView>
        </RadzenStack>

    </RadzenHeader>
    <AuthorizeView>
        <Authorized>
            <RadzenSidebar @bind-Expanded="@sidebar1Expanded" Style="width: 200px;">
                <RadzenPanelMenu>
                    <RadzenPanelMenuItem Text="Мои заведения" Icon="deck" Path="/MySpotsPage" />
                    <RadzenPanelMenuItem Text="Мои сотрудники" Icon="diversity_1" Path="/MyEmployeesPage" />
                    <RadzenPanelMenuItem Text="Меню" Icon="menu_book" Path="/ttkTable" />
                    <RadzenPanelMenuItem Text="Мои поставщики" Icon="local_shipping" Path="/MyShippersPage" />
                </RadzenPanelMenu>
            </RadzenSidebar>
        </Authorized>
    </AuthorizeView>
    <RadzenBody>
        <div class="rz-p-4">
            @Body
        </div>
    </RadzenBody>
</RadzenLayout>

<style>
    .sidebar-toggle {
        height: 100%;
        color: white;
        transition: color 0.5s, opacity 0.5s; /* Плавный переход */
    }

        .sidebar-toggle:hover {
            color: rgba(255, 255, 255, 0.7); /* Измените цвет и прозрачность */
            background-color: rgba(0, 0, 0, 0); /* Пример фона при наведении */
        }
</style>

@code {
    private UserLoginDto? userLoginDto { get; set; }
    bool sidebar1Expanded = true;



    // protected override async Task OnInitializedAsync()
    // {
    // }

    private void OnLogin()
    {
        NavigationManager.NavigateTo("/login", false);
    }
    private void OnRegister()
    {
        NavigationManager.NavigateTo("/signup", false);
    }

    private void OnMyProfileClick()
    {
        NavigationManager.NavigateTo("/myProfile", false);

    }

    private void OnSettingsClick()
    {
        NavigationManager.NavigateTo("/settings", false);

    }

    private async Task OnLogoutClick()
    {
        var result = await UserService.Logout();
        await AuthStateProvider.GetAuthenticationStateAsync();
        NavigationManager.NavigateTo("/", false);
    }
}